FROM pytorch/pytorch:2.1.0-cuda11.8-cudnn8-runtime

WORKDIR /app

ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Etc/UTC

RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    python3-dev \
    ffmpeg \
    libsndfile1 \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY api.py ./

ENV PYTHONPATH=/app
ENV HF_HOME=/app/.cache/huggingface
ENV TRANSFORMERS_CACHE=/app/.cache/huggingface

ENV STORAGE_BACKEND=local
ENV LOCAL_STORAGE_ROOT=/data/storage
ENV AWS_REGION=us-east-1
ENV S3_BUCKET=elevenlabs-clone
ENV S3_PREFIX=qwen-tts-output
ENV API_KEY=12345
ENV QWEN_TTS_MODEL_ID=Qwen/Qwen3-TTS-12Hz-0.6B-CustomVoice
ENV QWEN_TTS_MODEL_MODE=custom_voice
ENV QWEN_TTS_TOKENIZER_ID=Qwen/Qwen3-TTS-Tokenizer-12Hz
ENV QWEN_TTS_VOICES=Cherry,Chelsie,Ethan,Serena,Dylan,Jada
ENV QWEN_TTS_MAX_TEXT_LENGTH=3000
ENV QWEN_TTS_MAX_NEW_TOKENS=2048

EXPOSE 8000

CMD ["uvicorn", "api:app", "--host", "0.0.0.0", "--port", "8000"]
